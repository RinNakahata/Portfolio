# システム要件定義書

##  文書情報

- **作成日**: 2025-08-23
- **バージョン**: v1.1
- **作成者**: Rin Nakahata
- **最終更新**: 2025-08-25

---

##  プロジェクト目標

### 主要目的
- データの取得、可視化できるWebアプリケーションの開発
- DBを保守・運用する環境の構築。
- インフラ環境のIaC化により、構築の自動化、災害対応強化など。
- DBの監視システムの構築

### 成功基準
1. 完全に動作するWebアプリケーションの構築 Phase1完了
2. インフラコードの完全な自動化 Terraform検証完了
3. 適切な監視・運用体制の確立 Phase3予定

---

##  機能要件

### 1. Webアプリケーション機能

#### 1.1 静的Webサイト
- **目的**: プロジェクト概要・技術説明の表示
- **要件**:
  - レスポンシブデザイン
  - 高速な表示速度（CDN利用）
  - HTTPS対応
  - モバイル対応

#### 1.2 REST API 実装完了
- **目的**: DynamoDBとの連携によるデータ操作
- **フレームワーク**: FastAPI
- **エンドポイント**:
  ```
  GET  /health              - ヘルスチェック 
  GET  /api/users           - ユーザー一覧取得 
  POST /api/users           - ユーザー作成 
  GET  /api/users/{id}      - ユーザー詳細取得 
  PUT  /api/users/{id}      - ユーザー更新 
  DELETE /api/users/{id}    - ユーザー削除 
  GET  /api/metrics         - IoTメトリクス取得 
  POST /api/metrics         - IoTメトリクス登録 
  ```
- **実装特徴**:
  - 自動APIドキュメント生成（Swagger UI）
  - Pydantic によるデータ検証
  - 構造化ログ出力
  - エラーハンドリング完備

#### 1.3 IoTデータシミュレーション
- **目的**: 時系列データの管理例を示す
- **データ種類**:
  - 温度データ（-10〜50℃）
  - 湿度データ（0〜100%）
  - ステータス（active/inactive/error）
- **生成頻度**: 5分間隔

### 2. 管理機能

#### 2.1 監視・アラート
- **メトリクス監視**:
  - API レスポンス時間
  - エラー率
  - リクエスト数
  - インフラリソース使用率

#### 2.2 ログ管理
- **アプリケーションログ**: JSON構造化ログ
- **アクセスログ**: ALB経由のアクセス記録
- **エラーログ**: 例外・障害情報

---

##  非機能要件

### 1. パフォーマンス要件

| 項目 | 要件 | 測定方法 |
|------|------|----------|
| API応答時間 | 平均 < 200ms | CloudWatch メトリクス |
| 静的サイト表示 | 初回読み込み < 2秒 | ブラウザ開発者ツール |
| スループット | 100 req/min | 負荷テスト |
| 可用性 | 99.9% | アップタイム監視 |

### 2. スケーラビリティ要件

#### 2.1 自動スケーリング
- **ECS タスク**: CPU 70%で自動スケールアウト
- **DynamoDB**: オンデマンド課金でオートスケール
- **ALB**: 自動負荷分散

#### 2.2 リソース制限
- **最小構成**: ECS タスク 1個
- **最大構成**: ECS タスク 3個（コスト制限）
- **タスクスペック**: CPU 0.25vCPU, Memory 512MB

### 3. セキュリティ要件

#### 3.1 ネットワークセキュリティ
- **VPC分離**: Private SubnetでECS実行
- **セキュリティグループ**: 最小権限でのアクセス制御
- **SSL/TLS**: すべての通信をHTTPS化

#### 3.2 認証・認可
- **API認証**: 今回は未実装（シンプル化のため）
- **AWS IAM**: サービス間の適切な権限設定
- **データ暗号化**: DynamoDB・S3で保存時暗号化

#### 3.3 データ保護
- **個人情報**: 本プロジェクトでは扱わない
- **ログ保護**: 機密情報のログ出力禁止
- **アクセス制御**: AWS リソースへの最小権限アクセス

### 4. 運用要件

#### 4.1 監視・通知
- **CloudWatch Alarms**:
  - CPU使用率 > 80%
  - エラー率 > 5%
  - レスポンス時間 > 500ms
- **通知手段**: CloudWatch → SNS → Email

#### 4.2 バックアップ・復旧
- **DynamoDB**: Point-in-time recovery有効
- **設定ファイル**: Gitでのバージョン管理
- **災害復旧**: 他リージョンでの再構築可能

#### 4.3 ログ保持
- **CloudWatch Logs**: 30日間保持
- **ALB ログ**: S3で90日間保持

---

##  技術要件

### 1. 開発環境要件

#### 1.1 ローカル開発 環境構築完了
- **OS**: Windows 10/11 (会社PC制限により変更)
- **言語**: Python 3.11+
- **フレームワーク**: FastAPI（確定・実装完了）
- **コンテナ**: Docker & Docker Compose 
- **追加構成**:
  - 本番用・開発用 Dockerfile 分離
  - DynamoDB Local 統合（開発環境）
  - Hot reload 対応

#### 1.2 CI/CD
- **バージョン管理**: Git & GitHub
- **パイプライン**: GitHub Actions
- **デプロイ**: 自動デプロイ（プッシュトリガー）

### 2. インフラ要件

#### 2.1 AWS サービス
| サービス | 用途 | 設定 |
|----------|------|------|
| VPC | ネットワーク分離 | 10.0.0.0/16 |
| ECS/Fargate | コンテナ実行 | 0.25vCPU, 512MB |
| ALB | 負荷分散 | HTTP/HTTPS |
| DynamoDB | データ保存 | オンデマンド |
| S3 | 静的ファイル | Standard |
| CloudFront | CDN | 東京エッジ |
| CloudWatch | 監視・ログ | 基本メトリクス |

#### 2.2 リージョン・AZ
- **メインリージョン**: ap-northeast-1 (東京)
- **Multi-AZ**: パブリック2AZ、プライベート2AZ

---

##  コスト要件

### 月額予算制限
- **開発期間**: $20/月以下
- **デモ期間**: $10/月以下
- **無料利用枠**: 最大限活用

### コスト最適化
1. **Fargate**: 最小スペック使用
2. **DynamoDB**: オンデマンド + 無料枠
3. **S3**: Standard + 5GB無料枠
4. **CloudWatch**: 基本メトリクスのみ
5. **開発完了後**: リソース削除

---

##  制約事項

### 1. スコープ外機能
- ユーザー認証・ログイン機能
- 複雑なビジネスロジック
- リアルタイム通信（WebSocket等）
- マルチテナント対応


### 2. 運用制約
- **24時間運用**: デモ期間のみ
- **本番運用**: 対象外
- **SLA**: 規定なし

---

##  受け入れテスト

### 1. 機能テスト
- [x] 静的サイトが正常に表示される
- [x] API エンドポイントがすべて動作する（実装完了）
- [ ] DynamoDB でのデータ CRUD 操作（Phase2で統合テスト）
- [ ] IoT データが正常に生成・保存される（Phase2で統合テスト）

### 2. 性能テスト  
- [ ] API 応答時間が 200ms 以下
- [ ] 静的サイト表示が 2秒以下
- [ ] 100req/min の負荷に耐える

### 3. インフラテスト
- [x] Terraform で環境を構築できる（検証完了）
- [ ] CI/CD パイプラインが動作する（Phase2で検証）
- [ ] 監視・アラートが動作する（Phase3で実装・検証）
- [ ] ログが正常に記録される（Phase3で検証）

### 4. ドキュメントテスト
- [ ] 構築手順書通りに環境構築できる
- [ ] API 仕様書通りにAPIが動作する
- [ ] アーキテクチャ図と実環境が一致する

---

## プロジェクト進捗状況（2025-08-25更新）

### Phase 1完了項目
-  Terraform インフラコード実装・検証
-  FastAPI バックエンド完全実装
-  Docker 環境構築（本番・開発両対応）
-  静的フロントエンド実装
-  基本ドキュメント整備

### Phase 2: 統合・デプロイ（次回作業）
- [ ] Docker統合テスト実行
- [ ] AWS環境構築（terraform apply）
- [ ] ECR デプロイ・ECS統合

### 受け入れテスト進捗
- **機能テスト**: 50% 完了
- **インフラテスト**: 25% 完了  
- **ドキュメントテスト**: 75% 完了

---

**最終更新**: 2025-08-25 - Phase1完了、要件定義更新反映
